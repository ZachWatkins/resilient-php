#!/bin/bash
# Relative directory path between the calling directory and this file.
binpath="$( dirname -- "$0"; )";
# Wrap deployment ignore list lines in syntax accepted by `git ls-files` for excluding files from the output.
PARMS=()
IFS=$'\n' read -d '' -r -a args < "${binpath}/../deploy.gitignore"
for i in "${!args[@]}"; do
    PARMS+=(":!:${args[$i]}")
done
# Append to list of repository file names we want to deploy.
# This list will be used during CI/CD steps to determine what gets zipped up and sent to the server.
cat "${binpath}/../deploy.txt" > "${binpath}/../deployed.txt"
git ls-files -- "${PARMS[@]}" >> "${binpath}/../deployed.txt"
# Store dependencies.
vendor=$(composer config vendor-dir)
echo "${vendor}" >> "${binpath}/../deployed.txt"
ls "${vendor}" -a >> "${binpath}/../deployed.txt"
